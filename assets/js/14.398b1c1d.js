(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{258:function(t,e,a){"use strict";a.r(e);var s=a(28),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"кошеnьки"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#кошеnьки"}},[t._v("#")]),t._v(" Кошельки")]),t._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#введение"}},[t._v("Введение")])]),a("li",[a("a",{attrs:{href:"#процесс-обработки-данных"}},[t._v("Процесс обработки данных")])]),a("li",[a("a",{attrs:{href:"#авторизация-и-защита-информации-при-обмене-html-запросами-откnиками-через-сеть"}},[t._v("Авторизация и защита информации при обмене HTML-запросами/откликами через сеть")])]),a("li",[a("a",{attrs:{href:"#параметры-формы-запроса-дnя-торговцев-на-выставnение-счета"}},[t._v("Параметры формы запроса для Торговцев на выставление счета")])]),a("li",[a("a",{attrs:{href:"#параметры-откnика-по-созданному-счету"}},[t._v("Параметры отклика по созданному счету")])]),a("li",[a("a",{attrs:{href:"#обмен-информацией-посnе-подтверждения-опnаты-счета"}},[t._v("Обмен информацией после подтверждения оплаты счета")])]),a("li",[a("a",{attrs:{href:"#параметры-формы-запроса-дnя-торговцев-на-возврат-пnатежа"}},[t._v("Параметры формы запроса для Торговцев на возврат платежа")])])])]),a("p"),t._v(" "),a("h3",{attrs:{id:"введение"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#введение"}},[t._v("#")]),t._v(" Введение")]),t._v(" "),a("p",[t._v("IPSP предоставляет услугу для списания средств (выполнения платежа) с помощью Модуля электронных кошельков, взаимодействующего с Qiwi, WebMoney, Яндекс.Деньги и определяющего содержание и формат Web-запросов, реализуемых в Internet-браузере Торговцем через Протокол списания средств с электронных кошельков (система Wallets).")]),t._v(" "),a("h3",{attrs:{id:"процесс-обработки-данных"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#процесс-обработки-данных"}},[t._v("#")]),t._v(" Процесс обработки данных")]),t._v(" "),a("p",[t._v("Основной процесс обработки данных представлен следующими шагами:")]),t._v(" "),a("ol",[a("li",[t._v("Плательщик (Клиент Торговца – владелец кошелька) предлагает Торговцу оплатить продукт (или корзину товаров/услуг) путем списания суммы платежа с его кошелька, открытого в одном из известных сервисов электронных кошельков (Qiwi, WebMoney, Яндекс.Деньги).")]),t._v(" "),a("li",[t._v("Internet-магазин Торговца формирует запрос с необходимым набором параметров в JSON-формате, дополняет их данными о продукте и плательщике. Все запросы Торговца подвергаются обработке с помощью ключа JWT, который передается в заголовке запроса (более детальную информацию по обработке с помощью JWT см.ниже в отдельном описании/разделе).")]),t._v(" "),a("li",[t._v("Затем по URL он направляет HTTP-POST-запрос в систему Wallets, где при неуспешной валидации возвращается Торговцу один из типовых кодов ошибки, в каждом из которых предусмотрена возможность передачи текстового сообщения с описанием причины отказа от обработки:")])]),t._v(" "),a("ul",[a("li",[t._v("401 – Unautorized («авторизация не прошла»),")]),t._v(" "),a("li",[t._v("403 – Forbidden («транзакция запрещена»),")]),t._v(" "),a("li",[t._v('409 – Не удалось создать счет (напр., "Счет с таким merchant_external_id уже существует"), возвращается сообщение и дата')]),t._v(" "),a("li",[t._v('422 – "Something is wrong with this field!" ("Ошибка в валидации данных"- выдается, если какие-то переданные данные неверны или не заполнены обязательные поля), возвращается сообщение и одна из причин ошибки')]),t._v(" "),a("li",[t._v("500 – «Внутренняя ошибка».")])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("При успешной валидации параметров запроса формируется статус с кодом 201 «Счет создан» (при этом формируется uuid – уникальный идентификатор счета) и в свою очередь из системы Wallet идет HTTP - запрос с этими данными в соответствующий сервис электронных кошельков (Qiwi, WebMoney, Яндекс.Деньги), где еще раз происходит валидация.")]),t._v(" "),a("li",[t._v("При неуспешной валидации в сервисе электронных кошельков также формируется одно из типовых сообщений для Торговца:")])]),t._v(" "),a("ul",[a("li",[t._v("401 – Unautorized («авторизация не прошла»),")]),t._v(" "),a("li",[t._v("403 – Forbidden («транзакция запрещена»),")]),t._v(" "),a("li",[t._v("404 – «Not Found» («Запрашиваемые параметры не найдены»).")])]),t._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[t._v("Если же и здесь валидация прошла успешно, то в соответствующем сервисе кошелька формируется ticket формы. После этого система Wallets может отдать торговцу ссылку на оплату счета (при запросе статуса счета параметр pay_url) через предзаполенную форму данного сервиса кошелька.")]),t._v(" "),a("li",[t._v("После подтверждения Плательщиком согласия на списание средств (на платежной форме) сервис соответствующего кошелька переводит сумму с кошелька Плательщика на счет VRBank’а, открытый в этом же сервисе кошельков, статус платежа в БД системы Wallet (EWDB– eWallets database) меняется на «Счет оплачен», Торговец делает GET-запрос на получение статуса платежа в системе Wallets, которая после удержания комиссии вместе с данными счета переводит Торговцу остаток списанной суммы. На этом цикл обработки в системе Wallets завершается, а Торговец в свою очередь отпускает\nПлательщику оплаченный продукт/услугу.")])]),t._v(" "),a("h3",{attrs:{id:"авторизация-и-защита-информации-при-обмене-html-запросами-откnиками-через-сеть"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#авторизация-и-защита-информации-при-обмене-html-запросами-откnиками-через-сеть"}},[t._v("#")]),t._v(" Авторизация и защита информации при обмене HTML-запросами/откликами через сеть")]),t._v(" "),a("p",[t._v("При обработке платежей с помощью электронных кошельков используется JWT (JSON Web Token) - открытый стандарт (Request for Comments (RFC) 7519,), который определяет компактный и автономный способ безопасной передачи информации между сторонами в виде объекта JSON. Эта информация может быть проверена и надежна, потому что она имеет цифровую подпись. JWT могут быть подписаны с использованием секретного ключа или пары открытого / секретного ключей. Наиболее распространенные сценарии использования JWT – это авторизация и обмен информацией:")]),t._v(" "),a("p",[a("strong",[t._v("Авторизация")]),t._v("\nКак только пользователь вошел в систему, каждый последующий запрос будет включать JWT, позволяющий пользователю получать доступ к маршрутам, службам и ресурсам, которые разрешены с этим токеном. Единая регистрация - это функция, которая в настоящее время широко использует JWT из-за ее небольших накладных расходов и способности легко использоваться в разных доменах.")]),t._v(" "),a("p",[a("strong",[t._v("Обмен информацией")]),t._v("\nJWT являются хорошим способом безопасной передачи информации между сторонами. Поскольку JWT могут быть подписаны - например, с помощью пар открытого / закрытого ключей - вы можете быть уверены, что отправители – это именно те субъекты, кем они себя называют. Кроме того, поскольку подпись рассчитывается с использованием заголовка и полезной нагрузки (см. описание ниже), всегда можно убедиться, что содержимое не было подделано.\nВ компактной (сериализованной) форме JWT состоит из трех частей, разделенных точками: xxxxx.yyyyy.zzzzz, которые означают [ Header ].[ Payload ].[ Signature ] Заголовок (header) и полезная нагрузка (payload) присутствуют всегда, а вот подпись (signature) может отсутствовать. Заголовок в основном используется для описания криптографических функций, которые применяются для подписи и/или шифрования токена и обычно состоит из двух частей: тип токена (JWT) и используемый алгоритм хеширования подписи – обычно HMAC-SHA256 (HS256), как в данном случае, или RSA. Например, в JSON-формате:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"HS256"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"typ"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"JWT"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v('В некоторых случаях подпись, как упомянуто выше, и шифрование могут отсутствовать. Обычно это происходит, когда JWT является частью некоторой уже зашифрованной структуры данных. (в заголовке неподписанного токена заявка alg должна быть равна none). Затем этот JSON кодируется Base64Url для формирования первой части JWT. Вторая часть токена – это полезная нагрузка (payload), в которой размещается вся необходимая пользовательская информация (обычный объект JSON) и которая содержит заявки (требования). Слово "заявка (claims)" в спецификации обозначает просто часть информации и аналогична ключу JSON-объекта. Она представлена в виде пары “имя”: значение, где “имя” всегда является строкой. Заявки – это требования (запросы), касающиеся сущности (обычно информация о пользователе), и дополнительные данные. Здесь ни одно поле не является обязательным. Существует три типа требований: зарегистрированные (служебные), публичные и частные (пользовательские):')]),t._v(" "),a("p",[a("strong",[t._v("Зарегистрированные требования")]),t._v("\nЭто набор предварительно определенных утверждений, которые не являются обязательными, но рекомендуются для предоставления набора полезных, совместимых утверждений. Некоторые из них: iss (эмитент – издатель токена), exp (срок действия), sub (субъект), aud (аудитория – получатели), iat (время создания) и другие3. Полный список заявок приведен в реестре JSON Web Token Claims стандарта RFC 7519.")]),t._v(" "),a("p",[a("strong",[t._v("Публичные требования")]),t._v("\nОни могут быть определены по желанию теми, кто использует JWT. Но чтобы избежать коллизий, они должны быть определены в реестре веб-токенов IANA JSON или определены как URI (Uniform Resource Identifier), который содержит пространство имен, устойчивое к коллизиям.")]),t._v(" "),a("p",[a("strong",[t._v("Частные требования")]),t._v("\nЭто пользовательские претензии, созданные для обмена информацией между сторонами, которые согласны их использовать и не являются ни зарегистрированными, ни публичными претензиями. Хотя JWT могут быть зашифрованы для обеспечения секретности между сторонами, мы сосредоточимся на подписанных токенах. Подписанные токены могут проверять целостность утверждений, содержащихся в нем, в то время как зашифрованные токены скрывают эти утверждения от других сторон. Когда токены подписаны с использованием пар открытого и закрытого ключей, подпись также удостоверяет, что подписать его может только сторона, имеющая закрытый ключ. При этом применяется алгоритм, который указывается в первом его компоненте заголовка JWT (см.пример выше) с использованием секретного ключа (secret).")]),t._v(" "),a("p",[t._v("!!! Более детальное описание можно найти по ссылкам EN - https://jwt.io/, RU - https://proglib.io/p/jsontokens/")]),t._v(" "),a("p",[t._v("Для формирования JWT требуется:")]),t._v(" "),a("ol",[a("li",[t._v("Указать в поле iat текущее время (current Unix timestamp) .")]),t._v(" "),a("li",[t._v("Использовать алгоритм шифрования HS256 .")]),t._v(" "),a("li",[t._v("Приложить идентификатор продукта в поле product_id. Параметр product_id дополнительно передается во втором компоненте JWT - поле payload («полезная нагрузка»).")]),t._v(" "),a("li",[t._v("Подписать ключом, составленным из последовательности: merchant_id . product_id . merchant_external_id . product_secret_word")]),t._v(" "),a("li",[t._v("Полученный токен приложить к http запросу в заголовок 'Authorization: Bearer ' + token")])]),t._v(" "),a("p",[t._v("!!! Библиотеку под ваш язык программирования можно найти на сайте https://jwt.io.")]),t._v(" "),a("p",[t._v("Параметры JWT для создания секретного ключа secret (обязательные):")]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("merchant_id")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Integer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Идентификатор Торговца (внутренний)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("product_id")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Integer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Идентификатор оплачиваемого Продукта / назначения платежа")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("merchant_external_id")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string maxLength: 191")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Идентификатор счета в системе Торговца")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("product_secret_word")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Dotted numeric 123.45")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Секретное слово для данного Продукта")])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("h3",{attrs:{id:"параметры-формы-запроса-дnя-торговцев-на-выставnение-счета"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#параметры-формы-запроса-дnя-торговцев-на-выставnение-счета"}},[t._v("#")]),t._v(" Параметры формы запроса для Торговцев на выставление счета")]),t._v(" "),a("p",[t._v("Для проведения платежа с помощью кошельков необходимо сформировать счет на оплату. URI формы (HTTP URL): https://wallets.ipsp.com/invoices/")]),t._v(" "),a("p",[t._v("Параметры HTTP-POST запроса на выставление счета (JSON-format) Торговца:")]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Обязательность")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("merchant_external_id")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string maxLength: 191")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Идентификатор счета в системе Торговца")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("wallet")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum: Array [3]")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Тип протокола (Qiwi, WebMoney, Яндекс.Деньги): Enum: "qiwi" "webmoney" "yandex_money"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("amount")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("number($float) minimum: 0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Сумма к оплате в валюте Продукта. Валюта Продукта указывается в настройках Продукта Enum: "RUB" "EUR" "USD" здесь используются рубли)')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("сurrency")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Код валюты (пока только рубли): Enum: "RUB" "EUR" "USD"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("expires_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата/время действия выставленного счета, по истечении которой утрачивается возможность его оплаты")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("account")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string maxLength: 191")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Идентификатор кошелька (Счет в сервисе кошелька)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("email")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String ($email)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Электронная почта плательщика (владельца кошелька), которому выставляется счет")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("phone")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($E.164) nullable: true")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Номер телефона плательщика (владельца кошелька), которому выставляется счет на оплату, по стандарту E.164; example: +79671234567")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("comments")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Комментарии по счету: не более 255 символов, для yandex_money не более 128 символов")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("form")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("(описаны в отдельных таблицах – см.ниже)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("WalletForm - форма, состоящая из набора (массива) параметров для одного из видов кошелька: Qiwi (object) or WebMoney (object) or YandexMoney (object)")])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("p",[t._v("!!!! Оплачиваемый продукт может быть как реальным товаром/услугой, так и собирательным «товаром/услугой», например, корзиной или заказом.")]),t._v(" "),a("p",[t._v("Параметры массива "),a("code",[t._v("form")]),t._v(" для различных видов кошельков:")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("WalletForm = Qiwi")])])]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Обязательность")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("success_url")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($uri)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("URL для переадресации в случае успешного создания транзакции в Qiwi (должна вести на сайт Торговца)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("fail_url")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String($uri)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("URL для переадресации в случае неуспеха при создании транзакции в QIWI Wallet (должна вести на сайт Торговца)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("iframe")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Признак отображения страницы в iframe (при значении true - более компактный вид, удобный для встраивания ее в сайт провайдера). Если отсутствует, то по умолчанию принимается false")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("target")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Value: "iframe" Флаг, показывающий, что ссылки в параметрах successUrl / failUrl открываются в iframe. Если отсутствует, то считается выключенным')])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("WalletForm = WebMoney")])])]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Обязательность")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("lang")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v('string Enum: "en" "ru"')]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Параметр, определяющий язык формы")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("lmi_success_url")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String($uri)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("URL (на веб-сайте Торговца), на который будет переведен интернет-браузер плательщика в случае успешного выполнения платежа")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("lmi_success_method")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String ($string)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Метод (POST, GET или LINK), который будет использоваться при переходе на lmi_success_URL")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("lmi_fail_url")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String($uri)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("URL (на веб-сайте Торговца), на который будет переведен интернет-браузер плательщика в случае неуспешного платежа")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("lmi_fail_method")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String ($string)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Нет")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Метод (POST, GET или LINK), который будет использоваться при переходе на lmi_fail_url")])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("WalletForm = Yandex_money")])])]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Обязательность")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("return_url")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($uri)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("При успешной оплате (и если что-то пойдет не так) Яндекс.Касса вернет пользователя на return_url")])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("p",[t._v("Ниже дан пример заполнения POST-запроса на создание платежа для кошелька (в данном примере для кошелька Webmoney - перечислены только обязательные параметры, в том числе в массиве form):")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"merchant_external_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'asdqwe"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1313")]),t._v("ads"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3323")]),t._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"wallet"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'webmoney'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"amount"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"currency"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'RUB'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"form"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lmi_success_url"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//merch.com/success',")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lmi_fail_url"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//merch.com/fail',")]),t._v("\n     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expires_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" '"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2020")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-01")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("-30")]),t._v("T"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("29.396695")]),t._v("Z'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(";\n")])])]),a("p",[t._v("После того, как счет прошел валидацию сначала в системе Wallets, а затем в сервисе кошелька (Qiwi, WebMoney, Яндекс.Деньги), и получил статус 200 ему присваивается uuid (id предзаполненной формы). По итогам обработки счета Торговцу на URL из его запроса направляется уведомление вместе с uuid и подтверждается его успешный прием. Во все остальных случаях система Wallets будет осуществлять попытки доставить уведомление, увеличивая время между попытками. Если URL в запросе не был передан, будет взят URL из настроек продукта, фигурирующего в созданном счете с идентификатором uuid (например, 3fa85f64-5717-4562-b3fc-2c963f66afa6).")]),t._v(" "),a("h3",{attrs:{id:"параметры-откnика-по-созданному-счету"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#параметры-откnика-по-созданному-счету"}},[t._v("#")]),t._v(" Параметры отклика по созданному счету")]),t._v(" "),a("p",[t._v("Для получения информации по созданному счету с данным uuid Торговец направляет HTTP POST-запрос в систему Wallets на указанный URL, например, https://wallets.ipsp.com/invoices/3fa85f64-5717-4562-b3fc-2c963f66afa6 , в ответ на который он получит из системы Wallets HTTP GET-запрос по оплаченному счету с уведомлением Торговцу с полной информацией о созданном счете, содержащем полноценный URL (pay_url) для проведения платежа в сервисе кошелька (Qiwi, WebMoney, Яндекс.Деньги). Если Торговец будет присылать запросы раньше, чем в сервисе кошелька будет создан счет с предзаполненной формой, то он будет получать пустой ответ, пока процесс создания счета там не завершится.")]),t._v(" "),a("p",[t._v("Передаваемые параметры отклика (JSON-format) после создания счета следующие:")]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("uuid")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String($uuid)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Invoice UUID - Уникальный идентификатор счета/платежа")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("merchant_external_id")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string maxLength: 191")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("wallet")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum:Array [3]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Тип протокола Enum: "qiwi" "webmoney" "yandex_money"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("account")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String maxLength: 191")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Идентификатор кошелька Плательщика")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("amount")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("number($float) minimum: 0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Money - Сумма к списанию")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("fee")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("number($float) minimum: 0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Money - Сумма взимаемой комиссии")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("currency")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum:Array [3]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Код валюты (пока рубли). Enum: "RUB" "EUR" "USD"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("email")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($email) nullable: true")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("еМейл плательщика (владельца кошелька)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("phone")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String($E.164) nullable: true")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("PhoneNumber - Номер телефона клиента (владельца кошелька) в формате E.164 (https://en.wikipedia.org/wiki/E.164)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("comments")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String nullable: true")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Комментарии по счету")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("paid_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time) nullable: true")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата прохождения транзакции в сервисах Qiwi, WebMoney, Яндекс.Деньги")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("pay_url")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($uri) nullable: true")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("URL для получения оповещения о списании суммы платежа")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("status")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum: Array [6]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Invoice Status – Статус выставленного счета (Enum: "created" "in_progress" "succeed" "cancelled" "expired" "error")')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("expires_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time) nullable: true")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Срок действия счета (возможности оплатить)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("created_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата и время создания счета")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("updated_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата и время обновления статуса счета")])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("p",[t._v("Пример ответа на GET-запрос (в данном примере для кошелька Webmoney) может выглядеть так:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uuid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3fa85f64-5717-4562-b3fc-2c963f66afa6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"merchant_external_id"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"wallet"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webmoney"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"account"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"amount"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"fee"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"currency"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"email"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user@example.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"phone"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"+79671234567"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"comments"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pay_url"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"string"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"created"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expires_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-29T14:56:43.735Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"created_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-29T14:56:43.735Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"updated_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-29T14:56:43.735Z"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"обмен-информацией-посnе-подтверждения-опnаты-счета"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#обмен-информацией-посnе-подтверждения-опnаты-счета"}},[t._v("#")]),t._v(" Обмен информацией после подтверждения оплаты счета")]),t._v(" "),a("p",[t._v("После отправки этого сообщения система Wallets периодически опрашивает сервис соответствующего кошелька (Qiwi, WebMoney, Яндекс.Деньги) об изменении статуса счета на «Счет оплачен». После перехода Плательщика по ссылке pay_url, отправленной ему через Торговца, он попадает в\nплатежную форму на странице сервиса соответствующего кошелька, где ему предоставляется возможность подтвердить списание требуемой суммы с этого кошелька. После подтверждения Плательщиком списания суммы система Wallets получает информацию от сервиса соответствующего кошелька об изменении статуса счета на «Счет оплачен». Статус счета в БД системы Wallets также изменяется на «Счет оплачен».")]),t._v(" "),a("h3",{attrs:{id:"параметры-формы-запроса-дnя-торговцев-на-возврат-пnатежа"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#параметры-формы-запроса-дnя-торговцев-на-возврат-пnатежа"}},[t._v("#")]),t._v(" Параметры формы запроса для Торговцев на возврат платежа")]),t._v(" "),a("p",[t._v("При необходимости возврата Плательщику суммы, списанной с его кошелька, в случае отказа от сделки процесс организован аналогичным образом в виде системы HTTP POST-GET запросов. Для подписи JWT при запросе на возврат платежа параметр merchant_external_id отсутствует. араметр product_id также дополнительно передается в поле payload JWT. Параметры HTTP POST-запроса на возврат следующие:")]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Обязательность")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("invoice")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($uuid)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Invoice UUID - Идентификатор счета в системе Торговца")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("amount")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("number($float) minimum: 0")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Да")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Сумма возврата в валюте Продукта (должна быть меньше либо равна сумме счета, по которому производится возврат. Валюта Продукта указывается в настройках Продукта. (здесь используются рубли)")])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("p",[t._v("Пример POST-запроса:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"invoice"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3fa85f64-5717-4562-b3fc-2c963f66afa6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"amount"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Также как и при выставлении счета возможны следующие исходы (статусы) в уведомлениях при неуспешном возврате:")]),t._v(" "),a("ul",[a("li",[t._v("409 – Не удалось создать возврат,")]),t._v(" "),a("li",[t._v('422 – "Something is wrong with this field!" ("Ошибка в валидации данных"),')]),t._v(" "),a("li",[t._v("500 – «Внутренняя ошибка».")])]),t._v(" "),a("p",[t._v("При успешном исходе в БД системы Wallets запросу присваивается статус: 201 Результат создания возврата и передается следующий HTTP POST-отклик (Refund):")]),t._v(" "),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("uuid")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String($uuid)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Refund UUID- Уникальный идентификатор возврата платежа")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("wallet")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum: Array [3]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Тип протокола (Qiwi, WebMoney, Яндекс.Деньги) Enum: “qiwi” "webmoney" "yandex_money"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("amount")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("number($float) minimum: 0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Money – Возвращаемая сумма")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("currency")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Код валюты (пока рубли). Enum: "RUB" "EUR" "USD"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("status")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum: Array [5]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Refund Status – Статус возврата Enum: "created" "in_progress" "failed" "succeed" "error"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("created_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата и время возврата")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("updated_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата и время обновления статуса возврата")])])])]),t._v(" "),a("p",[t._v("[/datatables]")]),t._v(" "),a("p",[t._v("Пример заполнения POST-запроса на возврат:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uuid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3fa85f64-5717-4562-b3fc-2c963f66afa6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"wallet"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webmoney"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"amount"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"currency"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RUB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"created_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-31T18:25:53.976Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"updated_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-31T18:25:53.976Z"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("При запросе информации о возврате используется uuid так же, как и при создании счета, например, URL https://wallets.ipsp.com/refunds/3fa85f64-5717-4562-b3fc-2c963f66afa6 , и выдается отклик со статусом 404 (Not Found – Не найден) при неуспешном исходе или отклик со статусом 200 (Информация о возврате) при успешном исходе со следующими параметрами.")]),t._v(" "),a("p",[t._v("Пример отклика для кошелка Webmoney:")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"uuid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3fa85f64-5717-4562-b3fc-2c963f66afa6"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"wallet"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webmoney"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"amount"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"currency"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RUB"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"created_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-31T19:25:03.944Z"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"updated_at"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2020-01-31T19:25:03.944Z"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("[datatables autoWidth=true paging=false searching=false ordering=false info=false]")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Параметр")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[t._v("Формат")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Описание")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("uuid")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String($uuid)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Refund UUID- Уникальный идентификатор возврата платежа")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("wallet")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum: Array [3]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Тип протокола Enum: "qiwi" "webmoney" "yandex_money"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("amount")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("number($float) minimum: 0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Money - Сумма к списанию")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("currency")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum: Array [3]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('Код валюты (пока рубли). Enum: "RUB" "EUR" "USD"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("status")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("String Enum: Array [5]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('RefundStatus – Статус возврата Enum: "created" "in_progress" "failed" "succeed" "error"')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("created_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата и время возврата")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("updated_at")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("string($date-time)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Дата и время обновления статуса возврата")])])])]),t._v(" "),a("p",[t._v("[/datatables]")])])}),[],!1,null,null,null);e.default=n.exports}}]);